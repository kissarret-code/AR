<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kutyafelismer≈ë AR Alkalmaz√°s</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6d4c41, #a1887f);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 20px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #ffab91;
            color: #ffccbc;
        }
        
        .camera-container {
            position: relative;
            width: 100%;
            height: 400px;
            overflow: hidden;
            border-radius: 15px;
            margin-bottom: 20px;
            background: #000;
            box-shadow: 0 5px 25px rgba(0,0,0,0.5);
        }
        
        #video-element {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        #canvas-element {
            display: none;
        }
        
        .detection-box {
            position: absolute;
            border: 3px solid #ffab91;
            border-radius: 5px;
            background: rgba(255, 171, 145, 0.2);
            z-index: 5;
            pointer-events: none;
        }
        
        .detection-label {
            position: absolute;
            background: rgba(255, 171, 145, 0.9);
            color: #5d4037;
            padding: 5px 8px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .video-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 200px;
            z-index: 15;
            display: none;
            border: 3px solid #ffab91;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
        }
        
        .video-placeholder {
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            text-align: center;
            padding: 10px;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }
        
        .target-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        button {
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(to right, #ffab91, #ff8a65);
            color: #5d4037;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            font-weight: bold;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 10px rgba(0,0,0,0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .status {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .detected {
            background: rgba(255, 171, 145, 0.3);
            color: #ffccbc;
            animation: statusPulse 1.5s infinite;
        }
        
        .searching {
            background: rgba(255, 193, 7, 0.3);
            color: #ffe082;
        }
        
        .error {
            background: rgba(244, 67, 54, 0.3);
            color: #ffab91;
        }
        
        @keyframes statusPulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .info {
            background: rgba(255, 171, 145, 0.2);
            color: #ffccbc;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .info ul {
            padding-left: 20px;
            margin-top: 10px;
        }
        
        .info li {
            margin-bottom: 8px;
        }
        
        .button-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .button-row button {
            flex: 1;
            min-width: 160px;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin: 20px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(to right, #ffab91, #ff8a65);
            width: 0%;
            transition: width 0.5s;
        }
        
        .dog-facts {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-style: italic;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .camera-container {
                height: 300px;
            }
            
            .video-overlay {
                width: 250px;
                height: 150px;
            }
            
            .button-row {
                flex-direction: column;
            }
            
            .button-row button {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <h1>Kutyafelismer≈ë AR Alkalmaz√°s</h1>
    
    <div class="container">
        <div class="instructions">
            <p><strong>Haszn√°lati √∫tmutat√≥:</strong> Enged√©lyezd a kamer√°hoz val√≥ hozz√°f√©r√©st. Az alkalmaz√°s a TensorFlow.js seg√≠ts√©g√©vel kiz√°r√≥lag kuty√°kat ismer fel. Amikor a rendszer felismer egy kuty√°t, lej√°tsza a megadott YouTube vide√≥t.</p>
        </div>
        
        <div class="loading" id="loading">
            <p>Kutyafelismer≈ë modell bet√∂lt√©se...</p>
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
        </div>
        
        <div class="camera-container">
            <video id="video-element" autoplay playsinline></video>
            <canvas id="canvas-element"></canvas>
            <div class="video-overlay" id="video-overlay">
                <div class="video-placeholder" id="video-placeholder">
                    Kutyafelismer√©s! Vide√≥ lej√°tsz√°sa...
                </div>
                <iframe id="youtube-video" width="100%" height="100%" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="display:none;"></iframe>
            </div>
            <!-- Detection boxes will be added here dynamically -->
        </div>
        
        <div id="status" class="status searching">Keres√©s kuty√°k ut√°n...</div>
        
        <div class="target-info">
            <h3>Amikor a kamera kuty√°t √©szlel, lej√°tsza ezt a vide√≥t:</h3>
            <p>https://youtu.be/tn5wmfypE6s</p>
        </div>
        
        <div class="controls">
            <div class="button-row">
                <button id="start-btn">Kamera ind√≠t√°sa</button>
                <button id="switch-camera-btn">Kamera v√°lt√°sa</button>
                <button id="capture-btn">K√©p r√∂gz√≠t√©se</button>
            </div>
            <div class="button-row">
                <button id="toggle-detection-btn">Kutyakeres√©s ki</button>
                <button id="reset-btn">Vissza√°ll√≠t√°s</button>
            </div>
        </div>
        
        <div class="dog-facts">
            <p>üí° Tudtad, hogy a kuty√°k hall√°sa sokkal √©rz√©kenyebb az ember√©n√©l? Ak√°r 67 Hz-t≈ël 45 000 Hz-ig hallhatnak, m√≠g az emberek csak 20 Hz-t≈ël 20 000 Hz-ig.</p>
        </div>
        
        <div class="info">
            <p>Ez az alkalmaz√°s a TensorFlow.js √©s a COCO-SSD modell seg√≠ts√©g√©vel val√≥s√≠tja meg a kutyafelismer√©st. Amikor a kamera kuty√°t √©szlel, automatikusan lej√°tsza a megadott YouTube vide√≥t.</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const videoElement = document.getElementById('video-element');
            const canvasElement = document.getElementById('canvas-element');
            const statusDiv = document.getElementById('status');
            const startBtn = document.getElementById('start-btn');
            const switchCameraBtn = document.getElementById('switch-camera-btn');
            const toggleDetectionBtn = document.getElementById('toggle-detection-btn');
            const resetBtn = document.getElementById('reset-btn');
            const captureBtn = document.getElementById('capture-btn');
            const loadingDiv = document.getElementById('loading');
            const progressBar = document.getElementById('progress');
            const videoOverlay = document.getElementById('video-overlay');
            const videoPlaceholder = document.getElementById('video-placeholder');
            const youtubeVideo = document.getElementById('youtube-video');
            
            let stream = null;
            let useFrontCamera = false;
            let model = null;
            let detectionInterval = null;
            let isDetecting = false;
            let detectedDogs = [];
            let isVideoPlaying = false;
            let videoTimeout = null;
            
            // YouTube vide√≥ URL
            const youtubeURL = "https://www.youtube.com/embed/tn5wmfypE6s?autoplay=1&mute=1";
            
            // Bet√∂lt√©si folyamat szimul√°l√°sa
            async function simulateLoading() {
                for (let i = 0; i <= 100; i++) {
                    progressBar.style.width = i + '%';
                    await new Promise(resolve => setTimeout(resolve, 30));
                }
                loadingDiv.style.display = 'none';
            }
            
            // TensorFlow.js modell bet√∂lt√©se
            async function loadModel() {
                try {
                    statusDiv.textContent = "Kutyafelismer≈ë modell bet√∂lt√©se...";
                    statusDiv.className = "status searching";
                    
                    // COCO-SSD modell bet√∂lt√©se
                    model = await cocoSsd.load();
                    
                    statusDiv.textContent = "Modell bet√∂ltve. Kamera ind√≠t√°sa...";
                    await startCamera();
                    
                } catch (error) {
                    console.error("Hiba a modell bet√∂lt√©sekor:", error);
                    statusDiv.textContent = "Hiba: " + error.message;
                    statusDiv.className = "status error";
                }
            }
            
            // Kamera ind√≠t√°sa
            async function startCamera() {
                statusDiv.textContent = "Kamera ind√≠t√°sa...";
                statusDiv.className = "status searching";
                
                try {
                    // Megl√©v≈ë stream le√°ll√≠t√°sa
                    if (stream) {
                        stream.getTracks().forEach(track => track.stop());
                    }
                    
                    // Kamera kiv√°laszt√°sa
                    const constraints = {
                        video: {
                            facingMode: useFrontCamera ? "user" : "environment",
                            width: { ideal: 640 },
                            height: { ideal: 480 }
                        }
                    };
                    
                    stream = await navigator.mediaDevices.getUserMedia(constraints);
                    videoElement.srcObject = stream;
                    
                    // Kamera t√≠pusa alapj√°n be√°ll√≠tjuk a t√ºkr√∂z√©st
                    if (useFrontCamera) {
                        videoElement.style.transform = "scaleX(-1)";
                    } else {
                        videoElement.style.transform = "scaleX(1)";
                    }
                    
                    statusDiv.textContent = "Kamera el√©rve. Kuty√°k keres√©se...";
                    
                    // Kutyakeres√©s ind√≠t√°sa
                    startDogDetection();
                    
                } catch (error) {
                    console.error("Hiba a kamera ind√≠t√°sakor:", error);
                    statusDiv.textContent = "Hiba: " + error.message;
                    statusDiv.className = "status error";
                }
            }
            
            // Kutyakeres√©s ind√≠t√°sa
            function startDogDetection() {
                if (detectionInterval) {
                    clearInterval(detectionInterval);
                }
                
                isDetecting = true;
                toggleDetectionBtn.textContent = "Kutyakeres√©s ki";
                
                // Kuty√°k felismer√©se rendszeres id≈ëk√∂z√∂nk√©nt
                detectionInterval = setInterval(async () => {
                    if (model && isDetecting) {
                        detectDogs();
                    }
                }, 1000);
            }
            
            // Kuty√°k felismer√©se
            async function detectDogs() {
                if (!model || !isDetecting) return;
                
                try {
                    // Objektumok felismer√©se a vide√≥ban
                    const predictions = await model.detect(videoElement);
                    
                    // El≈ëz≈ë detekt√°l√°si eredm√©nyek t√∂rl√©se
                    clearDetections();
                    
                    // Csak kuty√°k sz≈±r√©se
                    const dogs = predictions.filter(prediction => 
                        prediction.class === 'dog' && prediction.score > 0.6
                    );
                    
                    if (dogs.length > 0) {
                        detectedDogs = dogs;
                        displayDetections(dogs);
                        
                        statusDiv.textContent = `${dogs.length} kutya felismerve!`;
                        statusDiv.className = "status detected";
                        
                        // Vide√≥ lej√°tsz√°sa, ha m√©g nem megy
                        if (!isVideoPlaying) {
                            playVideo();
                        }
                        
                        // Vide√≥ id≈ëz√≠t≈ë √∫jraind√≠t√°sa
                        resetVideoTimer();
                    } else {
                        statusDiv.textContent = "Keres√©s kuty√°k ut√°n...";
                        statusDiv.className = "status searching";
                    }
                } catch (error) {
                    console.error("Hiba a kutya felismer√©se sor√°n:", error);
                }
            }
            
            // Vide√≥ lej√°tsz√°sa
            function playVideo() {
                isVideoPlaying = true;
                videoOverlay.style.display = 'block';
                videoPlaceholder.style.display = 'none';
                youtubeVideo.style.display = 'block';
                youtubeVideo.src = youtubeURL;
            }
            
            // Vide√≥ elrejt√©se
            function hideVideo() {
                isVideoPlaying = false;
                videoOverlay.style.display = 'none';
                youtubeVideo.src = "";
                videoPlaceholder.style.display = 'flex';
                youtubeVideo.style.display = 'none';
            }
            
            // Vide√≥ id≈ëz√≠t≈ë √∫jraind√≠t√°sa
            function resetVideoTimer() {
                if (videoTimeout) {
                    clearTimeout(videoTimeout);
                }
                
                // 30 m√°sodperc ut√°n elrejtj√ºk a vide√≥t
                videoTimeout = setTimeout(() => {
                    hideVideo();
                }, 30000);
            }
            
            // Detekt√°lt kuty√°k megjelen√≠t√©se
            function displayDetections(dogs) {
                const videoWidth = videoElement.videoWidth;
                const videoHeight = videoElement.videoHeight;
                const container = document.querySelector('.camera-container');
                
                dogs.forEach(dog => {
                    const [x, y, width, height] = dog.bbox;
                    
                    // Sk√°l√°z√°s a vide√≥ m√©ret√©hez
                    const scaleX = videoElement.offsetWidth / videoWidth;
                    const scaleY = videoElement.offsetHeight / videoHeight;
                    
                    // Detekt√°l√°si doboz
                    const box = document.createElement('div');
                    box.className = 'detection-box';
                    box.style.left = `${x * scaleX}px`;
                    box.style.top = `${y * scaleY}px`;
                    box.style.width = `${width * scaleX}px`;
                    box.style.height = `${height * scaleY}px`;
                    
                    // C√≠mke
                    const label = document.createElement('div');
                    label.className = 'detection-label';
                    label.textContent = `Kutya (${Math.round(dog.score * 100)}%)`;
                    label.style.left = `${x * scaleX}px`;
                    label.style.top = `${(y * scaleY) - 25}px`;
                    
                    container.appendChild(box);
                    container.appendChild(label);
                });
            }
            
            // Detekt√°l√°sok t√∂rl√©se
            function clearDetections() {
                const boxes = document.querySelectorAll('.detection-box, .detection-label');
                boxes.forEach(box => box.remove());
            }
            
            // Kamera v√°lt√°sa
            switchCameraBtn.addEventListener('click', function() {
                useFrontCamera = !useFrontCamera;
                startCamera();
                hideVideo();
            });
            
            // Kutyakeres√©s ki/be kapcsol√°sa
            toggleDetectionBtn.addEventListener('click', function() {
                isDetecting = !isDetecting;
                
                if (isDetecting) {
                    toggleDetectionBtn.textContent = "Kutyakeres√©s ki";
                    startDogDetection();
                    statusDiv.textContent = "Kuty√°k keres√©se...";
                    statusDiv.className = "status searching";
                } else {
                    toggleDetectionBtn.textContent = "Kutyakeres√©s be";
                    clearInterval(detectionInterval);
                    clearDetections();
                    hideVideo();
                    statusDiv.textContent = "Kutyakeres√©s kikapcsolva";
                    statusDiv.className = "status";
                }
            });
            
            // Kamera ind√≠t√°sa gomb
            startBtn.addEventListener('click', function() {
                startCamera();
                hideVideo();
            });
            
            // K√©p r√∂gz√≠t√©se
            captureBtn.addEventListener('click', function() {
                const context = canvasElement.getContext('2d');
                canvasElement.width = videoElement.videoWidth;
                canvasElement.height = videoElement.videoHeight;
                
                if (useFrontCamera) {
                    context.translate(canvasElement.width, 0);
                    context.scale(-1, 1);
                    context.drawImage(videoElement, 0, 0, canvasElement.width, canvasElement.height);
                    context.setTransform(1, 0, 0, 1, 0, 0);
                } else {
                    context.drawImage(videoElement, 0, 0, canvasElement.width, canvasElement.height);
                }
                
                // Detekt√°l√°si dobozok hozz√°ad√°sa
                detectedDogs.forEach(dog => {
                    const [x, y, width, height] = dog.bbox;
                    context.strokeStyle = '#ffab91';
                    context.lineWidth = 3;
                    context.strokeRect(x, y, width, height);
                    
                    context.fillStyle = 'rgba(255, 171, 145, 0.8)';
                    context.font = '16px Arial';
                    context.fillText(`Kutya (${Math.round(dog.score * 100)}%)`, x, y > 20 ? y - 5 : 15);
                });
                
                // K√©p let√∂lt√©se
                const dataUrl = canvasElement.toDataURL('image/png');
                const link = document.createElement('a');
                link.download = 'kutya_felismeres.png';
                link.href = dataUrl;
                link.click();
                
                statusDiv.textContent = "Kutya k√©pe r√∂gz√≠tve!";
                statusDiv.className = "status detected";
                
                setTimeout(() => {
                    statusDiv.textContent = "Kuty√°k keres√©se...";
                    statusDiv.className = "status searching";
                }, 3000);
            });
            
            // Vissza√°ll√≠t√°s gomb
            resetBtn.addEventListener('click', function() {
                clearDetections();
                hideVideo();
                statusDiv.textContent = "Kuty√°k keres√©se...";
                statusDiv.className = "status searching";
                startDogDetection();
            });
            
            // Oldal bet√∂lt√©se
            simulateLoading();
            await loadModel();
        });
    </script>
</body>
</html>
